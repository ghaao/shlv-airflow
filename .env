# 기본 설정
AIRFLOW_UID=1000
_AIRFLOW_WWW_USER_USERNAME=airflow
_AIRFLOW_WWW_USER_PASSWORD=shinhan1

# === 메모리 최적화 (16GB RAM 고려) ===
# Celery Worker 프로세스 수 제한 (CPU 코어 수 고려)
AIRFLOW__CELERY__WORKER_CONCURRENCY=4       # 각 워커당 4개 태스크 처리

# === 병렬 처리 최적화 (8 Core CPU 활용) ===
# 전체 시스템 병렬 처리 설정 
AIRFLOW__CORE__PARALLELISM=16               # 전체 시스템에서 최대 16개 태스크 동시 실행
AIRFLOW__CORE__MAX_ACTIVE_TASKS_PER_DAG=8   # 각 DAG당 최대 8개 태스크 동시 실행
AIRFLOW__CORE__MAX_ACTIVE_RUNS_PER_DAG=4    # 각 DAG당 최대 4개 run 동시 실행

# DAG 병렬 처리
AIRFLOW__SCHEDULER__MAX_DAGRUNS_TO_CREATE_PER_LOOP=8
AIRFLOW__SCHEDULER__MAX_DAGRUNS_PER_LOOP_TO_SCHEDULE=4

# 스케줄러 멀티프로세싱
AIRFLOW__SCHEDULER__PARSING_PROCESSES=2

# === 스토리지 최적화 (50GB 제한 고려) ===
# 로그 설정 (보존 기간 30일 유지)
AIRFLOW__LOGGING__BASE_LOG_FOLDER=/opt/airflow/logs
AIRFLOW__LOGGING__LOGGING_LEVEL=INFO

# DAG 파일 처리 최적화
AIRFLOW__CORE__DAGBAG_IMPORT_TIMEOUT=30

# === 스케줄러 최적화 ===
# 스케줄러 성능 향상
AIRFLOW__SCHEDULER__DAG_DIR_LIST_INTERVAL=300
AIRFLOW__SCHEDULER__CATCHUP_BY_DEFAULT=False
AIRFLOW__SCHEDULER__MAX_THREADS=2

# === 데이터베이스 연결 최적화 ===
# PostgreSQL 연결 풀 설정
AIRFLOW__DATABASE__SQL_ALCHEMY_POOL_SIZE=5
AIRFLOW__DATABASE__SQL_ALCHEMY_MAX_OVERFLOW=10
AIRFLOW__DATABASE__SQL_ALCHEMY_POOL_RECYCLE=3600

# === 웹서버 최적화 ===
# 웹서버 워커 수 제한
AIRFLOW__WEBSERVER__WORKERS=2
AIRFLOW__WEBSERVER__WORKER_TIMEOUT=120

# === Airflow 자체 SSL 설정 ===
# SSL 인증서 파일 경로 (컨테이너 내부 경로)
# AIRFLOW__WEBSERVER__WEB_SERVER_SSL_CERT=/opt/airflow/ssl/airflow.crt
# AIRFLOW__WEBSERVER__WEB_SERVER_SSL_KEY=/opt/airflow/ssl/airflow.key

# SSL 포트 설정 (기본값: 8080)
# SSL 활성화 시 HTTPS 포트로 변경
# AIRFLOW__WEBSERVER__WEB_SERVER_PORT=8443

# === 보안 설정 ===
# Fernet 키 설정 (보안을 위해 실제 운영시 변경 필요), python bash에서 아래 명령어 수행 후 반영.
# python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
AIRFLOW__CORE__FERNET_KEY=OkZHPVlfSW9CvqnkSxZwz8oNKhWPCJyU2vXVJbbVJ9Y=

# === 타임존 설정 ===
# AIRFLOW__CORE__DEFAULT_TIMEZONE=Asia/Seoul
AIRFLOW__CORE__DEFAULT_TIMEZONE=Asia/Ho_Chi_Minh

# 추가: 경고 메시지 제거를 위한 설정
AIRFLOW__METRICS__STATSD_ON=False
AIRFLOW__METRICS__TIMER_UNIT_CONSISTENCY=True

# === 이메일 설정 ===
# AIRFLOW__EMAIL__EMAIL_BACKEND=airflow.providers.sendgrid.utils.emailer.send_email
# AIRFLOW__EMAIL__EMAIL_CONN_ID=sendgrid_default

# === 로그 정리 자동화 ===
# 오래된 로그 자동 정리 설정
AIRFLOW__LOGGING__DELETE_WORKER_PODS=True
# 추가: 로그 보존 기간 설정 (30일)
AIRFLOW__LOGGING__DELETE_LOCAL_LOGS=True